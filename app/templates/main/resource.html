{% extends 'main/base.html' %}

{% block title %}–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ—Å—É—Ä—Å–∞ - {{ resource.name }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ideas.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/resources.css') }}">
{% endblock %}

{% block content %}
<div class="nav">
  <a href="{{ url_for('main.index') }}">–ì–ª–∞–≤–Ω–∞—è > </a>
  <a href="{{ url_for('resource.open') }}"> –ü—Ä–æ–¥–≤–∏–≥–∞–µ–º—Å—è –≤ –æ—Å–≤–æ–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤. –ü—Ä–æ–±–Ω—ã–µ —É—Ä–æ–∫–∏ > </a>
  <a href="#">{{ resource.name }}</a>
</div>

<div class="main-box">
        <!-- <h2>{{ resource.name }}</h2>

  <div class="one-resources" style="width: 60%; margin-left: 20%;">
    <div class="pdf-viewer-container pdf-resources-one">

<iframe src="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}"
        title="–ü—Ä–æ—Å–º–æ—Ç—Ä PDF: {{ resource.name }}"
        class="pdf-same-file">
  –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä PDF.
  –ü–æ–∂–∞–ª—É–π—Å—Ç–∞,
  <a href="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}">
    —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª
  </a>.
</iframe>

    </div>

    <div class="info-resources-one">
<br>
          <div class="votes">
            <button class="like-btn" data-id="{{ resource.id }}"><img src="{{ url_for('static', filename='images/like.png') }}"></button>
            <span id="likes-{{ resource.id }}">{{ resource.likes or 0 }}</span>
            <button class="dislike-btn" data-id="{{ resource.id }}"><img src="{{ url_for('static', filename='images/like.png') }}"></button>
            <span id="dislikes-{{ resource.id }}">{{ resource.dislikes or 0 }}</span>
          </div>

  <hr> -->
  <br><br>
    <div class="one-idea">
    <div class="pdf-viewer-container pdf-idea-one">

      <iframe src="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}" title="–ü—Ä–æ—Å–º–æ—Ç—Ä PDF: {{ resource.name }}" class="pdf-same-file">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä PDF.
        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, <a href="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}">—Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª</a>.
      </iframe>

    </div>

    <div class="info-idea-one">
      <h2>{{ resource.name }}</h2>
      <h4>{{ resource.dop }}</h4>
      <p class="description">{{ resource.description }}</p>

            
<div class="votes">
    <button class="like-btn" data-id="{{ resource.id }}"><img src="{{ url_for('static', filename='images/like-new.png') }}"></button>
    <span id="likes-{{ resource.id }}" class="votes-score">{{ resource.likes or 0 }}</span> &nbsp;
    <button class="dislike-btn" data-id="{{ resource.id }}"><img src="{{ url_for('static', filename='images/like-new.png') }}"></button>
    <span id="dislikes-{{ resource.id }}" class="votes-score">{{ resource.dislikes or 0 }}</span>
  </div>

<!-- <hr style="width: 100%;border: 0.5px solid rgb(255, 255, 255);"> -->

    </div>
  </div>

  <div class="under-info">

<div class="under-info-part">
    <div style="margin-top: 10px; text-align: right;">
    <a href="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}" download class="download-btn">
      üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
    </a>
  </div>
  <div style="margin-top: 10px; text-align: right;">
  <a href="{{ url_for('static', filename='uploads/resources/' ~ resource.id ~ '/' ~ resource.file) }}" target="_blank" class="fullscreen-btn">
    <img src="{{ url_for('static', filename='images/open-full.png') }}">
    
  </a>
</div>
</div>

<div class="under-info-part">
<a href="{{ url_for('resource.open') }}">–ö –¥—Ä—É–≥–∏–º –ø—Ä–æ–±–Ω—ã–º —É—Ä–æ–∫–∞–º</a>
</div>

  </div>

<br>
 <h1>–¢–µ—Å—Ç –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º —É—Ä–æ–∫–∞</h1>
 <p style="text-align: center; font-size:larger; font-weight: 200;">–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —É—Å–≤–æ–µ–Ω—ã –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –∏ –Ω–∞–≤—ã–∫–∏</p>

 <div class="test-block">
  <div class="top-test">
    <span class="question-counter2">–í–æ–ø—Ä–æ—Å 1</span>
  <div class="question-counter"> <span style="color:#06A5EA">1</span> / 15</div>
  </div>

  <div class="main-test">
    <div class="a">{{ resource.test|safe }}</div>
  
     <div class="b"><button class="next-question">–î–∞–ª–µ–µ</button></div>
  </div>

  <span class="last-inf">–í–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É.</span>
</div>

<div class="rezalt-close"></div>
<div class="rezalt-block">
  <h2>–í—ã –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç:</h2>
  <p>{{ resource.name }}</p>
  <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
  <p class="rezalt-block-p"> </p> 

  <span>–í—ã–±–∏—Ä–∞–π—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–±–Ω—ã–µ —É—Ä–æ–∫–∏ –∏ –æ—Å–≤–∞–∏–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è. </span>  <br>
  <button class="rezalt-block-but">–í—ã–π—Ç–∏</button>
</div>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const userVotes = {}; // —Ö—Ä–∞–Ω–∏–º –≥–æ–ª–æ—Å–∞ –ø–æ id –∏–¥–µ–∏: 'like', 'dislike' –∏–ª–∏ null

          document.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', (event) => {
              event.stopPropagation();
              const id = btn.dataset.id;
              handleVote(id, 'like', btn);
            });
          });

          document.querySelectorAll('.dislike-btn').forEach(btn => {
            btn.addEventListener('click', (event) => {
              event.stopPropagation();
              const id = btn.dataset.id;
              handleVote(id, 'dislike', btn);
            });
          });

          function handleVote(id, type, btn) {
            const likeBtn = document.querySelector(`.like-btn[data-id="${id}"]`);
            const dislikeBtn = document.querySelector(`.dislike-btn[data-id="${id}"]`);

            const currentVote = userVotes[id] || null;

            let action = null;

            if (currentVote === type) {
              // —Å–Ω–∏–º–∞–µ–º –≥–æ–ª–æ—Å
              userVotes[id] = null;
              action = `un${type}`; // 'unlike' –∏–ª–∏ 'undislike'
              btn.classList.remove('active');
              if (type === 'like') {
                dislikeBtn.disabled = false;
              } else {
                likeBtn.disabled = false;
              }
            } else {
              // —Å—Ç–∞–≤–∏–º –≥–æ–ª–æ—Å
              userVotes[id] = type;
              action = type;
              if (type === 'like') {
                likeBtn.classList.add('active');
                dislikeBtn.disabled = true;
                dislikeBtn.classList.remove('active');
              } else {
                dislikeBtn.classList.add('active');
                likeBtn.disabled = true;
                likeBtn.classList.remove('active');
              }
            }

            fetch(`/resources/vote/${id}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
              },
              body: JSON.stringify({ action: action })
            })
            .then(res => res.json())
            .then(data => {
              document.getElementById(`likes-${id}`).textContent = data.likes;
              document.getElementById(`dislikes-${id}`).textContent = data.dislikes;
            });
          }
        });
      </script>

<script>
let counter = 0;
let current = 0;
let answered = false;

const questions = document.querySelectorAll('.one-question');
const nextButton = document.querySelector('.next-question');
const getResultButton = document.querySelector('.get-rezalt');
const questionCounter = document.querySelector('.question-counter');
const questionCounter2 = document.querySelector('.question-counter2');

const rezaltBlock = document.querySelector('.rezalt-block');
const rezaltCloze = document.querySelector('.rezalt-close');
const rezaltP = document.querySelector('.rezalt-block-p');
const rezaltClozeButton = document.querySelector('.rezalt-block-but');

// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã, –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ
questions.forEach((q, i) => {
  q.style.display = (i === 0) ? 'flex' : 'none';
});

// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
function updateQuestionCounter() {
  questionCounter.innerHTML = ` <bold style="color:#06A5EA">${current + 1}</bold> / ${questions.length}`;
  questionCounter2.innerHTML = `–í–æ–ø—Ä–æ—Å ${current + 1} `;
}
updateQuestionCounter();

// –ü—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É "–£–∑–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç"
getResultButton.style.display = 'none';

// –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
for (let q of questions) {
  const buttons = q.querySelectorAll('button');
  for (let btn of buttons) {
    btn.addEventListener('click', function () {
      if (answered) return;

      const parent = btn.closest('.one-question');
      const allBtns = parent.querySelectorAll('button');

      for (let b of allBtns) {
        b.disabled = true;
      }

      if (btn.value % 3 === 0 && btn.value % 4 === 0) {
        counter++;
        // btn.style.backgroundColor = 'green';

        btn.classList.add('good');
      } else {
        // btn.style.backgroundColor = 'red';

        btn.classList.add('bad');
      }

      answered = true;
    });
  }
}

// –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ ->"
nextButton.addEventListener('click', function () {
  if (!answered) return;

  // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
  questions[current].style.display = 'none';
  current++;

  if (current < questions.length) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
    questions[current].style.display = 'flex';
    answered = false;
    updateQuestionCounter();
  }

  if (current === questions.length - 1) {
    // –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å
    nextButton.style.display = 'none';
    getResultButton.style.display = 'inline-block';
    updateQuestionCounter();
  }
});

// –£–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
getResultButton.addEventListener('click', function () {
  const total = questions.length;
  const percent = (counter / total) * 100;
  let message = "";

  if (percent < 30) {
    message = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –ª—É—á—à–µ!";
  } else if (percent < 80) {
    message = "–ù–µ–ø–ª–æ—Ö–æ, –Ω–æ –µ—Å—Ç—å –∫—É–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è.";
  } else {
    message = "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!";
  }

  rezaltP.innerHTML = `
    <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</strong> ${counter} –∏–∑ ${total}<br><br>
    <span style="font-size:18px">${message}</span>
  `;
  
  rezaltBlock.style.display = "block";
  rezaltCloze.style.display = "block";
});

rezaltClozeButton.addEventListener('click', function () {
  rezaltBlock.style.display = "none";
  rezaltCloze.style.display = "none";
});
</script>
    </div>
  </div>
</div>
{% endblock %}